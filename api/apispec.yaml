openapi: 3.0.0
info:
  title: Tawny
  description: |-
    A lastfm Api Proxy

    https://github.com/dozro/tawny/tree/main
  version: 0.1.0
servers:
  - url: /api/v1
paths:
  '/user/{username}/':
    get:
      description: |-
        Get User Info

        Lastfm Docu: https://www.last.fm/api/show/user.getInfo
      security:
        - defaultApiKey: []
      parameters:
        - name: username
          in: path
          required: true
          description: the username
          schema:
            type: string
      responses:
        '200':
          description: The fetched User Info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userinfo'
        '401':
          $ref: '#/components/responses/ApiErrorReturn401'
        '500':
          description: internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      summary: Get User Info
      operationId: user.getInfo
      tags:
        - user
  '/user/{username}/tracks/loved':
    get:
      description: 'Get loved tracks of specified User - https://www.last.fm/api/show/user.getLovedTracks'
      security:
        - defaultApiKey: []
      parameters:
        - name: limit
          in: query
          required: false
          description: The limit
          schema:
            type: number
        - name: page
          in: query
          required: false
          description: The page you want to get
          schema:
            type: number
        - name: username
          in: path
          required: true
          description: the username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: the fetched list of loved songs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLovedTracks'
        '307':
          description: a redirect
        '401':
          $ref: '#/components/responses/ApiErrorReturn401'
        '500':
          description: internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      x-stoplight:
        id: zvsb8k7ludcjm
      summary: Get Users Loved Tracks
      operationId: user.getLovedTracks
      tags:
        - user
  '/user/{username}/tracks/recent':
    get:
      summary: get recent tracks
      tags:
        - user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRecentTracks'
        '401':
          $ref: '#/components/responses/ApiErrorReturn401'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      operationId: 'get-user-:username-tracks-recent'
      x-stoplight:
        id: hxzn5dp9xaxte
      parameters:
        - schema:
            type: number
          in: query
          name: limit
          description: The limit
        - schema:
            type: number
          in: query
          name: page
          description: The page
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
        - name: fetch_musicbrainz
          in: query
          required: false
          schema:
            type: boolean
        - name: username
          in: path
          required: true
          description: The username
          schema:
            type: string
  '/user/{username}/tracks/current':
    get:
      summary: get current track
      tags:
        - user
      parameters:
        - name: username
          in: path
          required: true
          description: The username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRecentTracks'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      operationId: 'get-user-:username-tracks-current'
      x-stoplight:
        id: r4nu8mvgwcbbf
      description: equivalent to calling recent with limit of 1
  '/user/{username}/tracks/current/embed':
    get:
      summary: get current track
      tags:
        - user
      parameters:
        - name: username
          in: path
          required: true
          description: The username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: The operation was successful
          content: {}
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
      operationId: 'get-user-:username-tracks-current-embed'
      x-stoplight:
        id: r4nu8mvgwcbbf
      description: equivalent to calling recent with limit of 1
  /hmac/sign/base64:
    post:
      summary: sign a request
      tags:
        - hmac
        - hmac_base64
      responses:
        '200':
          description: successfully signed
      operationId: post-hmac-sign
      x-stoplight:
        id: 1hthsq5tpk5xi
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          description: HMAC Pre-Shared-Key
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HmacProxyRequest'
      security: []
  /hmac/sign:
    post:
      summary: sign a request
      tags:
        - hmac
      responses:
        '200':
          description: successfully signed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HmacProxyRequest'
            application/yaml:
              schema:
                $ref: '#/components/schemas/HmacProxyRequest'
        '401':
          $ref: '#/components/responses/ApiErrorReturn401'
      operationId: post-hmac-sign
      x-stoplight:
        id: 1hthsq5tpk5xi
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          description: HMAC Pre-Shared-Key
          required: true
        - schema:
            type: boolean
          in: query
          name: isBase64
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HmacProxyRequest'
      security: []
  /hmac/verify:
    post:
      summary: verify a hmac signed method
      tags:
        - hmac
      responses:
        200:
          description: request success
          content:
            application/json:
              schema:
                type: object
      operationId: get-hmac-verify
      x-stoplight:
        id: rrb5zs04683wq
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          required: true
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: boolean
      security: []
  /hmac/verify/againstServer:
    post:
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: string
            enum:
              - false
              - true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      responses:
        '200':
          description: Proxy request succeeded
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad input or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          $ref: '#/components/responses/ApiErrorReturn403'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
      security: []
  /hmac/execute:
    post:
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: string
            enum:
              - true
              - false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      responses:
        '200':
          description: Proxy request succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HmacProxyResponse'
        '400':
          description: Bad input or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Invalid signature or not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
      security: []
    get:
      security: []
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: true
          in: query
          schema:
            type: boolean
            enum:
              - true
        - name: request
          description: base64 encoded request
          in: query
          required: true
          schema:
            type: string
        - name: signature
          in: query
          description: the signature of the request
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful request
  '/user/{username}/top/tracks':
    parameters:
      - schema:
          type: string
        name: username
        in: path
        required: true
    get:
      summary: get the top tracks
      tags:
        - user
      responses:
        '200':
          description: Request successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTopTracks'
            application/xml:
              schema:
                $ref: '#/components/schemas/UserTopTracks'
            application/yaml:
              schema:
                $ref: '#/components/schemas/UserTopTracks'
        '401':
          description: Unauthorized
      operationId: get-user-username-top-tracks
      x-stoplight:
        id: l3tqqqu7any10
  '/user/{username}/top/albums':
    parameters:
      - schema:
          type: string
        name: username
        in: path
        required: true
    get:
      summary: get a user's topalbums
      tags: 
        - user
      responses:
        200:
          description: success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTopAlbums'
      operationId: get-user-username-top-albums
      x-stoplight:
        id: thto4eee1rct0
  /musicbrainz/lookup/artist/by-mbid/{artistMbid}:
    parameters:
      - schema:
          type: string
        name: artistMbid
        in: path
        required: true
    get:
      summary: lookup artist details by mbid
      operationId: mb-lookup-artist-mbid
      tags:
        - musicbrainz
      responses:
        200:
          description: Request successful
      
security:
  - defaultApiKey: []
components:
  securitySchemes:
    defaultApiKey:
      description: The Api Key you obtained from lastfm
      type: apiKey
      name: Authorization
      in: header
  schemas:
    ApiErrorCode:
      type: number
      enum:
        - 0
        - 1
        - 2
        - 3
    Success:
      type: boolean
      description: If the operation was successfull
      example: false
    ApiError:
      type: object
      properties:
        http_code:
          type: number
          description: The HTTP Error Code
          example: 403
        internal_error_code:
          type: number
          description: The internal Error Code
          example: 1
        internal_error_msg:
          type: string
          nullable: true
          description: Internal Error message
        success:
          $ref: '#/components/schemas/Success'
        data:
          type: object
          nullable: true
        message:
          type: string
          example: Invalid HMAC signature
      required:
        - success
        - message
    HmacProxyResponse:
      type: object
    HmacProxyRequest:
      type: object
      properties:
        method:
          type: string
          example: GET
          enum:
            - "GET"
            - "POST"
            - "HEAD"
        api_identifier:
          type: string
          example: /user/
          enum:
            - "/user/"
            - "/user/tracks/current/"
            - "/user/tracks/current/embed"
            - "/user/tracks/recent/"
        api_parameters:
          description: The Api Parameters you want to provide
          type: object
          required:
            - username
          properties:
            username:
              type: string
              example: alice
              description: The Username you want to specify
            page:
              type: number
              example: 1
              description: The page of the result you want to get
            limit:
              type: number
              example: 15
              description: The limit of a page
        body:
          type: string
          nullable: true
          default: null
      required:
        - method
        - api_identifier
    SignedRequest:
      type: object
      title: "The signed Request (not encoded)"
      properties:
        signature:
          type: string
          example: 4acfb7f8b2...
        request:
          $ref: '#/components/schemas/HmacProxyRequest'
      required:
        - signature
        - request
    SignedBase64Request:
      type: object
      title: "A signed Request Base64 encoded"
      properties:
        signature:
          type: string
          example: 4acfb7f8b2...
        request:
          type: string

      required:
        - signature
        - request
    userinfo:
      description: the User Info
      properties:
        id:
          type: number
        name:
          type: string
        realname:
          type: string
        url:
          type: string
        imageurl:
          type: string
        country:
          type: string
        age:
          type: number
        gender:
          type: string
        subscriber:
          type: number
        playcount:
          type: number
        playlists:
          type: number
        bootstrap:
          type: number
        registered:
          type: string
      x-stoplight:
        id: cm8wxhqhlcyu8
    internalError:
      description: internal server error
      properties:
        code:
          type: number
        error:
          type: string
        data:
          properties:
            request:
              properties:
                host:
                  type: string
                path:
                  type: string
                query:
                  type: string
                method:
                  type: string
      x-stoplight:
        id: 8izaqp46xka2w
    UserLovedTracks:
      type: object
      x-stoplight:
        id: dca295db69d50
      properties:
        LovedTracks:
          type: array
          items:
            type: object
            properties:
              Name:
                type: string
              Mbid:
                type: string
              Url:
                type: string
              Date:
                type: string
              Image:
                type: string
              Artist:
                type: object
                properties:
                  Name:
                    type: string
                  Mbid:
                    type: string
                  Url:
                    type: string
              Streamable:
                type: integer
      description: The tracks a user loves
    UserRecentTracks:
      type: object
      description: The Tracks a user listened to recently
      properties:
        Track:
          type: array
          items:
            type: object
            required:
              - Name
              - Url
            properties:
              NowPlaying:
                type: boolean
                description: If the track is currently playing
              Name:
                type: string
              TrackMbid:
                type: string
              Url:
                type: string
                format: uri
              Date:
                type: string
                format: date
              Timestamp:
                type: string
                format: date-time
              Image:
                type: string
                format: uri
              Artist:
                $ref: '#/components/schemas/Artist'
              ArtistMbid:
                type: string
              Streamable:
                type: integer
              track_musicbrainz:
                $ref: '#/components/schemas/MusicbrainzRecording'
    UnauthorizedResponse:
      type: object
      properties:
        code:
          type: integer
        error:
          type: string
    UserTopAlbums:
      title: UserTopAlbums
      type: object
      properties:
        album:
          type: array
          items:
            $ref: '#/components/schemas/UserAlbums'
    UserAlbums:
      type: object
      properties:
        rank:
          type: integer
        name:
          type: string
        playcount:
          type: integer
        mbid:
          type: string
          nullable: true
        url:
          type: string
          nullable: false
    UserTopTracks:
      title: UserTopTracks
      x-stoplight:
        id: cyb8t04ime6kc
      x-tags:
        - user
      type: object
      properties:
        Track:
          type: array
          x-stoplight:
            id: f9mb6zc4qafqt
          items:
            x-stoplight:
              id: auk88nvcz8l0p
            type: object
            properties:
              Name:
                type: string
                x-stoplight:
                  id: q4nrczbqn00ny
              Rank:
                type: number
                x-stoplight:
                  id: bammx335ho12b
                description: The ranking
              Mbid:
                type: string
                x-stoplight:
                  id: jpaxv0skte5sm
              Url:
                type: string
                x-stoplight:
                  id: 5diri1bnp8y8s
                format: uri
              Date:
                type: string
                x-stoplight:
                  id: zaevkmn4p58w9
                format: date
              Image:
                type: string
                x-stoplight:
                  id: d2qjiz3ujigd7
                format: uri
                description: Link to the tracks image
              Artist:
                $ref: '#/components/schemas/Artist'
    Artist:
      title: Artist
      x-stoplight:
        id: t62jmolbbtatt
      type: object
      x-examples:
        Example 1:
          Name: Linkin Park
          Url: 'https://www.last.fm/music/Linkin+Park'
      required:
        - Name
      properties:
        Name:
          type: string
          x-stoplight:
            id: ebyksbo3zwigh
          description: The name of the artist
        Mbid:
          type: string
          x-stoplight:
            id: k4myih064khsb
        Url:
          type: string
          x-stoplight:
            id: u5uiuw3abgcr2
          format: uri
          description: The URL of the artist's entry on last.fm
    MusicbrainzRecording:
      type: object
      nullable: true
      properties:
        Recording:
          type: object
          properties:
            text:
              type: string
            id:
              type: string
            title:
              type: string
            length:
              type: integer
            artist_credit:
              type: object
              properties:
                name_credit:
                  type: array
                  items:
                    type: object
                    properties:
                      text:
                        type: string
                      joinphrase:
                        type: string
                      artist:
                        type: object
                        properties:
                          text:
                            type: string
                          id:
                            type: string
                          'type':
                            type: string
                          type_id:
                            type: string
                          name:
                            type: string
                          sort_name:
                            type: string
            release_list:
              type: object
            isrc_list:
              type: object
  responses:
    ApiErrorReturn401:
      description: Api Error 401
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'
        application/yaml:
          schema:
            $ref: '#/components/schemas/ApiError'
        application/xml:
          schema:
            $ref: '#/components/schemas/ApiError'
    ApiErrorReturn403:
      description: Api Error 401
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'
        application/yaml:
          schema:
            $ref: '#/components/schemas/ApiError'
        application/xml:
          schema:
            $ref: '#/components/schemas/ApiError'
x-internal: true
