openapi: 3.0.0
info:
  title: Tawny
  description: |-
    A lastfm Api Proxy

    https://github.com/dozro/tawny/tree/main
  version: 0.1.0
  summary: ''
servers:
  - url: /api/v1
paths:
  '/user/{username}/':
    get:
      description: |-
        Get User Info

        Lastfm Docu: https://www.last.fm/api/show/user.getInfo
      security:
        - defaultApiKey: []
      parameters:
        - name: username
          in: path
          required: true
          description: the username
      responses:
        '200':
          description: The fetched User Info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userinfo'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedResponse'
        '500':
          description: internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      summary: Get User Info
      operationId: user.getInfo
      tags:
        - user
  '/user/{username}/tracks/loved':
    get:
      description: 'Get loved tracks of specified User - https://www.last.fm/api/show/user.getLovedTracks'
      security:
        - defaultApiKey: []
      parameters:
        - name: limit
          in: query
          required: false
          description: The limit
          schema:
            type: number
        - name: page
          in: query
          required: false
          description: The page you want to get
          schema:
            type: number
        - name: username
          in: path
          required: true
          description: the username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: the fetched list of loved songs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLovedTracks'
        '307':
          description: a redirect
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedResponse'
        '500':
          description: internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      x-stoplight:
        id: zvsb8k7ludcjm
      summary: Get Users Loved Tracks
      operationId: user.getLovedTracks
      tags:
        - user
  '/user/{username}/tracks/recent':
    get:
      summary: get recent tracks
      tags:
        - user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRecentTracks'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      operationId: 'get-user-:username-tracks-recent'
      x-stoplight:
        id: hxzn5dp9xaxte
      parameters:
        - schema:
            type: number
          in: query
          name: limit
          description: The limit
        - schema:
            type: number
          in: query
          name: page
          description: The page
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
  '/user/{username}/tracks/current':
    get:
      summary: get current track
      tags:
        - user
      parameters:
        - name: username
          in: path
          required: true
          description: The username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRecentTracks'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/internalError'
      operationId: 'get-user-:username-tracks-current'
      x-stoplight:
        id: r4nu8mvgwcbbf
      description: equivalent to calling recent with limit of 1
  '/user/{username}/tracks/current/embed':
    get:
      summary: get current track
      tags:
        - user
      parameters:
        - name: username
          in: path
          required: true
          description: The username
          schema:
            type: string
        - name: signature
          in: query
          required: false
          description: the HMAC Signature for this OP
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            image/png:
      operationId: 'get-user-:username-tracks-current-embed'
      x-stoplight:
        id: r4nu8mvgwcbbf
      description: equivalent to calling recent with limit of 1
  /hmac/sign/base64:
    post:
      summary: sign a request
      tags:
        - hmac
        - hmac_base64
      responses:
        200:
          description: "successfully signed"
      operationId: post-hmac-sign
      x-stoplight:
        id: 1hthsq5tpk5xi
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          description: HMAC Pre-Shared-Key
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HmacProxyRequest'
      security: [ ]
  /hmac/sign:
    post:
      summary: sign a request
      tags:
        - hmac
      responses:
        200:
          description: "successfully signed"
      operationId: post-hmac-sign
      x-stoplight:
        id: 1hthsq5tpk5xi
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          description: HMAC Pre-Shared-Key
          required: true
        - schema:
            type: boolean
          in: query
          name: isBase64
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HmacProxyRequest'
      security: []
  /hmac/verify:
    post:
      summary: verify a hmac signed method
      tags:
        - hmac
      responses: {}
      operationId: get-hmac-verify
      x-stoplight:
        id: rrb5zs04683wq
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      parameters:
        - schema:
            type: string
          in: header
          name: HMAC-PSK
          required: true
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: boolean
      security: []
  /hmac/verify/againstServer:
    post:
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: string
            enum:
              - false
              - true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      responses:
        '200':
          description: Proxy request succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProxyResponse'
        '400':
          description: Bad input or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Invalid signature or not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
      security: []
  /hmac/execute:
    post:
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: false
          in: query
          schema:
            type: string
            enum:
              - true
              - false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignedRequest'
      responses:
        '200':
          description: Proxy request succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HmacProxyResponse'
        '400':
          description: Bad input or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Invalid signature or not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
      security: []
    get:
      security: []
      summary: Execute a signed HMAC proxy request
      tags:
        - hmac
      parameters:
        - name: isBase64
          description: if the request is base64 encoded
          required: true
          in: query
          schema:
            type: boolean
            enum:
              - true
        - name: request
          description: base64 encoded request
          in: query
          required: true
          schema:
            type: string
        - name: signature
          in: query
          description: the signature of the request
          required: true
          schema:
            type: string
      responses:
        200:
          description: "successful request"

security:
  - defaultApiKey: []
components:
  securitySchemes:
    defaultApiKey:
      description: The Api Key you obtained from lastfm
      type: apiKey
      name: Authorization
      in: header
  schemas:
    ApiErrorCode:
      type: number
      enum:
        - 0
        - 1
        - 2
        - 3
    ApiError:
      type: object
      properties:
        http_code:
          type: number
          example: 403
        internal_error_code:
          type: number
          example: 1
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Invalid HMAC signature
      required:
        - success
        - message
    HmacProxyResponse:
      type: object
    HmacProxyRequest:
      type: object
      properties:
        method:
          type: string
          example: GET
        api_identifier:
          type: string
          example: /user/
        api_parameters:
          type: object
          properties:
            username:
              type: string
              example: alice
        body:
          type: string
          nullable: true
      required:
        - method
        - url
    SignedRequest:
      type: object
      properties:
        signature:
          type: string
          example: 4acfb7f8b2...
        request:
          $ref: '#/components/schemas/HmacProxyRequest'
      required:
        - signature
        - request
    SignedBase64Request:
      type: object
      properties:
        signature:
          type: string
          example: 4acfb7f8b2...
        request:
          type: string
      required:
        - signature
        - request
    userinfo:
      description: the User Info
      properties:
        id:
          type: number
        name:
          type: string
        realname:
          type: string
        url:
          type: string
        imageurl:
          type: string
        country:
          type: string
        age:
          type: number
        gender:
          type: string
        subscriber:
          type: number
        playcount:
          type: number
        playlists:
          type: number
        bootstrap:
          type: number
        registered:
          type: date
      x-stoplight:
        id: cm8wxhqhlcyu8
    internalError:
      description: internal server error
      properties:
        code:
          type: number
        error:
          type: string
        data:
          properties:
            request:
              properties:
                host:
                  type: string
                path:
                  type: string
                query:
                  type: string
                method:
                  type: string
      x-stoplight:
        id: 8izaqp46xka2w
    UserLovedTracks:
      type: object
      x-stoplight:
        id: dca295db69d50
      properties:
        LovedTracks:
          type: array
          items:
            type: object
            properties:
              Name:
                type: string
              Mbid:
                type: string
              Url:
                type: string
              Date:
                type: string
              Image:
                type: string
              Artist:
                type: object
                properties:
                  Name:
                    type: string
                  Mbid:
                    type: string
                  Url:
                    type: string
              Streamable:
                type: integer
      description: The tracks a user loves
    UserRecentTracks:
      type: object
      properties:
        Track:
          type: array
          items:
            type: object
            properties:
              NowPlaying:
                type: boolean
              Name:
                type: string
              TrackMbid:
                type: string
              Url:
                type: string
              Date:
                type: string
              Timestamp:
                type: string
              Image:
                type: string
              Artist:
                type: string
              ArtistMbid:
                type: string
              Streamable:
                type: integer
      description: The Tracks a user listened to recently
    UnauthorizedResponse:
      type: object
      properties:
        code:
          type: integer
        error:
          type: string
x-internal: true
